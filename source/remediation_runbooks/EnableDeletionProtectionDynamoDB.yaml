# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0
---
description: |
  ### Document Name - ASR-EnableDynamoDBDeletionProtection
  ## What does this document do?
  Enables deletion protection on DynamoDB tables.

  ## Input Parameters
  * AutomationAssumeRole: (Required) The ARN of the role that allows Automation to perform the actions on your behalf.
  * Region: (Required) The region where the DynamoDB tables are located.

  ## Security Standards / Controls
  * AWS FSBP v1.0.0:   DynamoDB.6
  * CIS v1.2.0:     2.8
  * PCI:            DynamoDB.4

schemaVersion: "0.3"
assumeRole: "{{ AutomationAssumeRole }}"
parameters:
  AutomationAssumeRole:
    type: String
    description: (Required) The ARN of the role that allows Automation to perform the actions on your behalf.
    allowedPattern: '^arn:(?:aws|aws-us-gov|aws-cn):iam::\d{12}:role/[\w+=,.@-]+$'
  Region:
    type: String
    description: 'The region where the DynamoDB tables are located'
    allowedPattern: '^[a-z]{2}(?:-gov)?-[a-z]+-\d$'
outputs:
  - Remediation.Output

mainSteps:
  -
    name: Remediation
    action: 'aws:executeScript'
    outputs:
      - Name: Output
        Selector: $.Payload.response
        Type: StringMap
    inputs:
      InputPayload:
        region: '{{Region}}'
      Runtime: python3.8
      Handler: enable_deletion_protection
      Script: |-
        %%SCRIPT=EnableDeletionProtectionDynamoDB.py%%

    isEnd: true
